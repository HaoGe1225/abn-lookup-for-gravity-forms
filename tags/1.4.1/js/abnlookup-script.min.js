function itsg_gf_abnlookup_function(e,i,a){var s=gf_abnlookup_settings.ajax_url,o=gf_abnlookup_settings.validation_message_loading,t=gf_abnlookup_settings.validation_message_not_valid,n=gf_abnlookup_settings.validation_message_error_communicating,l=gf_abnlookup_settings.validation_message_11_char,d=gf_abnlookup_settings.text_checking,r=gf_abnlookup_settings.text_check_abn;!function(i){"use strict";var a=function(e){var a=i.ajax({type:"POST",url:s,data:e,tryCount:0,retryLimit:3,beforeSend:function(){g.hide(),c.html(o),f.val(d+" ... "),c.addClass("loading"),c.removeClass("error Active Cancelled validation_message")},success:function(e){if("undefined"!=typeof e)try{console.log(e),f.val(r);var i=JSON.parse(e);if(void 0!=i.exception)g.hide(),"Search text is not a valid ABN or ACN"==i.exception.exceptionDescription?c.html(t):c.text(i.exception.exceptionDescription),c.removeClass("Active Cancelled loading"),c.addClass("error validation_message"),h.hide(),y.hide(),b.hide(),C.hide(),E.hide(),w.hide(),S.hide(),T.hide(),m.val("").change(),k.val("").change(),x.val("").change(),N.val("").change(),A.val("").change(),D.val("").change(),j.val("").change(),v.prop("disabled",!1),u.prop("disabled",!1),v.prop("checked",!1),u.prop("checked",!1),m.prop("readonly",!1),k.prop("readonly",!1),x.prop("readonly",!1),N.prop("readonly",!1),A.prop("readonly",!1),D.prop("readonly",!1),j.prop("readonly",!1);else if(void 0!=i.businessEntity){console.log(i.businessEntity);var a=i.businessEntity.entityType.entityTypeCode,s=i.businessEntity.entityType.entityDescription,o=i.businessEntity.entityStatus.entityStatusCode,n=i.businessEntity.mainBusinessPhysicalAddress.postcode,l=i.businessEntity.mainBusinessPhysicalAddress.stateCode,d=i.businessEntity.entityStatus.effectiveFrom,_=new Date(d),p=("0"+_.getDate()).slice(-2),F=("0"+(_.getMonth()+1)).slice(-2),P=_.getFullYear();if(D.hasClass("dmy"))var Q=p+"/"+F+"/"+P;else if(D.hasClass("dmy_dash"))var Q=p+"-"+F+"-"+P;else if(D.hasClass("dmy_dot"))var Q=p+"."+F+"."+P;else if(D.hasClass("ymd_slash"))var Q=P+"/"+F+"/"+_;else if(D.hasClass("ymd_dash"))var Q=P+"-"+F+"-"+_;else if(D.hasClass("ymd_dot"))var Q=P+"."+F+"."+_;else var Q=F+"/"+p+"/"+P;if(void 0!=i.businessEntity.goodsAndServicesTax){var B=i.businessEntity.goodsAndServicesTax.effectiveFrom,_=new Date(B),p=("0"+_.getDate()).slice(-2),F=("0"+(_.getMonth()+1)).slice(-2),P=_.getFullYear();if(D.hasClass("dmy"))var O=p+"/"+F+"/"+P;else if(j.hasClass("dmy_dash"))var O=p+"-"+F+"-"+P;else if(j.hasClass("dmy_dot"))var O=p+"."+F+"."+P;else if(j.hasClass("ymd_slash"))var O=P+"/"+F+"/"+_;else if(j.hasClass("ymd_dash"))var O=P+"-"+F+"-"+_;else if(j.hasClass("ymd_dot"))var O=P+"."+F+"."+_;else var O=F+"/"+p+"/"+P;j.val(O).change(),j.prop("readonly",!0),T.show()}else T.hide(),j.val("").change();if("IND"==a)var Y="string"==typeof i.businessEntity.legalName.familyName?i.businessEntity.legalName.familyName:"",G="string"==typeof i.businessEntity.legalName.givenName?i.businessEntity.legalName.givenName:"",L="string"==typeof i.businessEntity.legalName.otherGivenName?i.businessEntity.legalName.otherGivenName:"",M=Y+", "+G+" "+L;else var M=i.businessEntity.mainName.organisationName;g.hide(),c.text(o+" - "+M),m.val(s).change(),m.prop("readonly",!0),k.val(o).change(),k.prop("readonly",!0),x.val(M).change(),x.prop("readonly",!0),N.val(n).change(),N.prop("readonly",!0),A.val(l).change(),A.prop("readonly",!0),D.val(Q).change(),D.prop("readonly",!0),c.removeClass("error loading validation_message"),c.addClass(o),void 0!=i.businessEntity.goodsAndServicesTax&&"0001-01-01"==i.businessEntity.goodsAndServicesTax.effectiveTo?(v.prop("checked",!0),v.prop("disabled",!1),u.prop("disabled",!0)):(u.prop("checked",!0),u.prop("disabled",!1),v.prop("disabled",!0)),h.show(),y.show(),C.show(),b.show(),E.show(),w.show(),S.show()}}catch(q){console.log(e),c.text(q),c.removeClass("loading Active Cancelled"),c.addClass("error validation_message")}},error:function(e,a,s){if("timeout"==a){if(this.tryCount++,this.tryCount<=this.retryLimit)return void i.ajax(this);c.text(n)}else c.text(e.responseText);f.val(r),c.removeClass("loading Active Cancelled"),c.addClass("error validation_message")},timeout:5e3});return a},_=!1,p=i(".gform_abnlookup_field_"+e+' input[type="text"]'),g=i(".gform_abnlookup_field_"+e+" .gfield_description.validation_message"),c=i(".itsg_abnlookup_response_"+e),f=i(".itsg_abnlookup_checkabn_"+e),h=i(".gform_abnlookup_entity_gst_field_"+e),v=i(".gform_abnlookup_entity_gst_field_"+e+' input[value="Yes"]'),u=i(".gform_abnlookup_entity_gst_field_"+e+' input[value="No"]'),y=i(".gform_abnlookup_entity_type_field_"+e),m=i(".gform_abnlookup_entity_type_field_"+e+" input"),b=i(".gform_abnlookup_entity_status_field_"+e),k=i(".gform_abnlookup_entity_status_field_"+e+" input"),C=i(".gform_abnlookup_entity_name_field_"+e),x=i(".gform_abnlookup_entity_name_field_"+e+" input"),E=i(".gform_abnlookup_entity_postcode_field_"+e),N=i(".gform_abnlookup_entity_postcode_field_"+e+" input"),w=i(".gform_abnlookup_entity_state_field_"+e),A=i(".gform_abnlookup_entity_state_field_"+e+" input"),S=i(".gform_abnlookup_entity_effective_from_field_"+e),D=i(".gform_abnlookup_entity_effective_from_field_"+e+" input"),T=i(".gform_abnlookup_gst_effective_from_field_"+e),j=i(".gform_abnlookup_gst_effective_from_field_"+e+" input");""!==c.html()?((v.is(":visible")&&1!=v.prop("checked")&&1!=u.prop("checked")||m.is(":visible")&&""==m.val()||k.is(":visible")&&""==k.val()||x.is(":visible")&&""==x.val()||N.is(":visible")&&""==N.val()||A.is(":visible")&&""==A.val()||D.is(":visible")&&""==D.val()||j.is(":visible")&&""==j.val())&&p.trigger("change"),v.is(":checked")?u.prop("disabled",!0):u.is(":checked")&&v.prop("disabled",!0),m.prop("readonly",!0),k.prop("readonly",!0),x.prop("readonly",!0),N.prop("readonly",!0),A.prop("readonly",!0),D.prop("readonly",!0),j.prop("readonly",!0)):(h.closest("li.gfield").hide(),y.closest("li.gfield").hide(),b.closest("li.gfield").hide(),C.closest("li.gfield").hide(),E.closest("li.gfield").hide(),w.closest("li.gfield").hide(),S.closest("li.gfield").hide(),T.closest("li.gfield").hide()),p.unbind("change").change(function(){var e=i(this).val().replace(/\D/g,"");if(11==e.length){console.log(e);var s=e,o={action:"itsg_gf_abnlookup_check_ajax",abn:s};_&&4!==_.readyState&&(console.log("Abort! -- another request has been submitted."),_.abort()),_=a(o)}else h.hide(),y.hide(),b.hide(),C.hide(),E.hide(),w.hide(),S.hide(),T.hide(),m.val("").change(),k.val("").change(),x.val("").change(),N.val("").change(),A.val("").change(),D.val("").change(),j.val("").change(),v.prop("disabled",!1),u.prop("disabled",!1),v.prop("checked",!1),u.prop("checked",!1),g.hide(),c.html(l),c.addClass("error validation_message"),c.removeClass("loading Active Cancelled")})}(jQuery)}jQuery(document).bind("gform_post_render gform_post_conditional_logic",function(e){var i=gf_abnlookup_settings.abnlookup_fields,a=gf_abnlookup_settings.form_id;for(var s in i)if(i.hasOwnProperty(s)){var o=s,t=i[s].validate,n=i[s].dateFormat;"undefined"!=typeof t&&(console.log("abn-lookup-for-gravity-forms :: field_id: "+o+" field_validate_abnlookup: "+t+" field_dateFormat: "+n),itsg_gf_abnlookup_function(o,t,n),jQuery("#input_"+a+"_"+o).unbind("keydown").keydown(function(e){(13==e.which||13==e.keyCode)&&(e.preventDefault(),jQuery(this).trigger("change"))}))}});